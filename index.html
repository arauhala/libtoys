<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Libtoys by arauhala</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Libtoys</h1>
        <p>Generic C++ microwidgets for UI development (proof of concept)</p>

        <p class="view"><a href="https://github.com/arauhala/libtoys">View the Project on GitHub <small>arauhala/libtoys</small></a></p>


        <ul>
          <li><a href="https://github.com/arauhala/libtoys/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/arauhala/libtoys/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/arauhala/libtoys">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h3>
<a name="introduction-to-libtoys" class="anchor" href="#introduction-to-libtoys"><span class="octicon octicon-link"></span></a>Introduction to libtoys</h3>

<p>libtoys is a proof-of-concept library demonstrating a design based on the simplest possible UI widgets that do exactly one things and nothing more. These 'micro widgets' are not only extremely simple, but there is also only a handful of them. In fact, the main provided micro widgets are:</p>

<ul>
<li>
<strong>tx</strong>       - text, e.g. <code>tx("hello", calibriFont, rgba{0,0,0,255})</code>
</li>
<li>
<strong>rc</strong>       - rectangle, e.g. <code>rc(black)</code>
</li>
<li>
<strong>sz</strong>       - determines widget size, e.g. <code>sz(xy(50, 50),rc(black))</code>
</li>
<li>
<strong>lr</strong>, <strong>ud</strong>, <strong>fb</strong> - splits widget in x, y or z dimension. e.g. <code>lr(rc(red), rc(blue))</code>
          has red left half and blue right half.</li>
<li>
<strong>lay</strong>      - positions widget in a relative or absolute coordinate within the area. 
           e.g. <code>lay(xy(0.5,0.5),tx("middle",f, c))</code> layouts the text in the middle.</li>
<li>
<strong>on_click</strong> - executes function, when widget is clicked.
           e.g. <code>on_click([](click&amp;){exit()},tx("click to exit",f,c))</code>
</li>
</ul><p>These widgets can be combined to create e.g. a button (code is C++14):</p>

<div class="highlight highlight-C++"><pre><span class="k">auto</span> <span class="n">quit</span> <span class="o">=</span> 
    <span class="n">sz</span><span class="p">(</span><span class="n">xy</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>                                <span class="c1">// 1. set size</span>
       <span class="n">on_click</span><span class="p">([](</span><span class="n">click</span><span class="o">&amp;</span><span class="p">){</span> <span class="n">system</span><span class="o">::</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="p">},</span>    <span class="c1">// 2. exit on click</span>
                <span class="n">fb</span><span class="p">(</span><span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">tx</span><span class="p">(</span><span class="s">"exit"</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">black</span><span class="p">)),</span> <span class="c1">// 3. text on front middle</span>
                   <span class="n">rc</span><span class="p">(</span><span class="n">rgba</span><span class="p">{</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span><span class="mi">0</span><span class="p">})));</span>    <span class="c1">// 4. rectangle background</span>
</pre></div>

<p>This simplistic button looks like this:</p>

<p><img src="http://arauhala.github.io/libtoys/button.png" alt=""></p>

<h3>
<a name="design-and-capabilities" class="anchor" href="#design-and-capabilities"><span class="octicon octicon-link"></span></a>Design and capabilities</h3>

<p>The leading idea behind libtoys is minimalism and it follows strictly the UNIX way, where the system should consist of minimalistic tools doing one orthogonal thing right and where the power raises from the way the components are combined instead of the component's internal complexity. This extreme minimalism brings small learning overhead and make it easier to master the small tool set thus making it faster to get things done.</p>

<p>Also often the abstract technical primitives are forever (e.g. BSD sockets), while more specific services tend to not fully fulfil the wavering application needs. E.g  bigger applications (and especially games) may rely almost entirely on custom UI components. libtoys does not even try to provide ready-to-use widgets, but instead supports you in making your own, which is anyway a major activity in UI projects. </p>

<p>Other design goals of libtoys are:</p>

<ul>
<li>
<strong>Generality</strong>. libtoys can be used to layout and draw 'text' (as demonstrated in unit test cases) as an addition to drawing normal 2D graphics (as demonstrated by the OpenSDL usage). It is a generic template library that should be portable to many environments (e.g. libcurses).</li>
<li>
<strong>Declarativeness</strong>. This reduces redundancy, bugs and needed effort.</li>
<li>
<strong>Statelessness</strong>. All micro widgets are stateless. The statelessness reduces the complexity by lot and eliminates classes of bugs. Statelessness also allows reuse of widget instances. </li>
<li>
<strong>Terseness</strong>. Composing widget from micro widgets can be done inline with few lines of code. Class definitions or explicit memory management are not required. </li>
<li>
<strong>Minimized overhead</strong>. 

<ol>
<li>Traditional 'macro' widget may consist of dozens or even hundreds of micro widgets (e.g. pop up list with images). Here hundreds of heap allocations could bring significant memory / computation overhead compared to traditional macro widget designs. </li>
<li>This overhead is avoided by composing the micro widgets compile-time with template magic. This allows flattening a deep micro widget structure into a single template class. E.g. the 7 microwidget button in previous example has sizeof(quit) 96 bytes and can be entirely allocated in stack.</li>
<li>This compile-time composition should also flatten and inline the functions in the micro widget composition hierarchy. E.g Instead of 7 draw(), recv() and size() methods for each micro widgets in the quit button, there should be single heavily inlined &amp; optimized draw, recv and size methods for the quit button widget.</li>
</ol>
</li>
</ul><p>The expectation is that the simplicity, declarativeness, statelessness and terseness improve productivity. Also providing technical primitives instead of high level services/policy typically means that the framework won't get in your way. This reflects  my own experience of having worked with similar UI kit I created for Java.</p>

<p>Of course: you cannot get that much done with the library yet, as it is incomplete. Also solution has its issues like verbose errors for mistakes (because heavy template usage) and there may be potential for badly scaling layouting calculations, because lack of states (all thought compiler may optimize recalculations out when widgets are composed compile-time via templates and the problem can anyway be solved by adding stateful 'cache' microwidgets in deep microwidget structures.). There are also likely bugs and design issues, because library's young age. The solution also lays lot of faith on the compiler and its optimizations.</p>

<h3>
<a name="code-sample--screenshot" class="anchor" href="#code-sample--screenshot"><span class="octicon octicon-link"></span></a>Code sample &amp; screenshot:</h3>

<p>Here's a bigger code sample demonstrating the toolkit. Following example demonstrates...</p>

<ol>
<li>...writing a simple interactive UI...</li>
<li>...with a manipulated state (variable c) and a dynamic property (rgbtext) that changes when c is modified </li>
<li>...and how to encapsulate compile-time composed widgets in separate modules via itoy interface and how to use the encapsulated widgets.</li>
</ol><div class="highlight highlight-C++"><pre><span class="cp">#include "toys/sdl.h"</span>
<span class="cp">#include &lt;sstream&gt;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">toys</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">toys</span><span class="o">::</span><span class="n">sdl</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">toys</span><span class="o">::</span><span class="n">sdl</span><span class="o">::</span><span class="n">vals</span><span class="p">;</span>

<span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">itoy</span><span class="o">&gt;</span> <span class="n">make_radio_button</span><span class="p">(</span><span class="k">const</span> <span class="n">font</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="k">const</span> <span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="o">&gt;&amp;</span> <span class="n">changed</span><span class="p">);</span>
<span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">itoy</span><span class="o">&gt;</span> <span class="n">make_resizing_item</span><span class="p">();</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// set up infra. sdltoys constructor initializes SDL  </span>
    <span class="n">sdltoys</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">font</span> <span class="n">f</span><span class="p">(</span><span class="s">"/usr/share/fonts/truetype/freefont/FreeMono.ttf"</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>

    <span class="c1">// data used by widgets</span>
    <span class="k">const</span> <span class="n">rgba</span> <span class="n">black</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>   <span class="c1">// this is immutable</span>
    <span class="n">rgba</span> <span class="n">c</span><span class="p">{</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>       <span class="c1">// this is mutable state used by reference</span>
    <span class="k">auto</span> <span class="n">rgbtxt</span> <span class="o">=</span> <span class="n">prop</span><span class="p">([</span><span class="o">&amp;</span><span class="n">c</span><span class="p">]()</span> <span class="p">{</span>     <span class="c1">// this is dynamic state produced by lambda</span>
        <span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span> <span class="n">buf</span><span class="p">;</span>
        <span class="n">buf</span><span class="o">&lt;&lt;</span><span class="s">"r:"</span><span class="o">&lt;&lt;</span><span class="kt">int</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">r</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="s">",g:"</span><span class="o">&lt;&lt;</span><span class="kt">int</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">g</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="s">",b:"</span><span class="o">&lt;&lt;</span><span class="kt">int</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">b</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">buf</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="k">auto</span> <span class="n">radio</span> <span class="o">=</span> <span class="n">make_radio_button</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">c</span><span class="p">](</span><span class="kt">bool</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span> <span class="n">c</span><span class="p">.</span><span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="o">?</span><span class="mi">200</span><span class="o">:</span><span class="mi">100</span><span class="p">);</span> <span class="p">});</span>
    <span class="k">auto</span> <span class="n">titledradio</span> <span class="o">=</span> <span class="n">lr</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">tx</span><span class="p">(</span><span class="s">"green:"</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">black</span><span class="p">)),</span> <span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">radio</span><span class="p">.</span><span class="n">get</span><span class="p">()));</span>

    <span class="k">auto</span> <span class="n">resizing</span> <span class="o">=</span> <span class="n">make_resizing_item</span><span class="p">();</span>

    <span class="k">auto</span> <span class="n">text</span> <span class="o">=</span> <span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">tx</span><span class="p">(</span><span class="n">rgbtxt</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">black</span><span class="p">));</span>
    <span class="k">auto</span> <span class="n">moreblue</span> <span class="o">=</span> <span class="n">on_click</span><span class="p">([</span><span class="o">&amp;</span><span class="n">c</span><span class="p">](</span><span class="n">click</span><span class="o">&amp;</span><span class="p">){</span><span class="n">c</span><span class="p">.</span><span class="n">b</span><span class="o">+=</span><span class="mi">32</span><span class="p">;</span> <span class="p">},</span>
                             <span class="n">fb</span><span class="p">(</span><span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">tx</span><span class="p">(</span><span class="s">"more blue"</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">black</span><span class="p">)),</span> <span class="n">rc</span><span class="p">(</span><span class="n">rgba</span><span class="p">{</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">0</span><span class="p">})));</span>
    <span class="k">auto</span> <span class="n">quit</span> <span class="o">=</span> <span class="n">on_click</span><span class="p">([](</span><span class="n">click</span><span class="o">&amp;</span><span class="p">){</span> <span class="n">system</span><span class="o">::</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="p">},</span>
                         <span class="n">fb</span><span class="p">(</span><span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">tx</span><span class="p">(</span><span class="s">"exit"</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">black</span><span class="p">)),</span> <span class="n">rc</span><span class="p">(</span><span class="n">rgba</span><span class="p">{</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span><span class="mi">0</span><span class="p">})));</span>

    <span class="k">auto</span> <span class="n">z</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">ud</span><span class="p">(</span><span class="mf">0.33</span><span class="p">,</span>
                   <span class="n">text</span><span class="p">,</span>
                   <span class="n">ud</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span>
                      <span class="n">lr</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">titledradio</span><span class="p">,</span> <span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">resizing</span><span class="p">.</span><span class="n">get</span><span class="p">())),</span>
                         <span class="n">lr</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">sz</span><span class="p">(</span><span class="n">xy</span><span class="p">(</span><span class="mf">0.67</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">moreblue</span><span class="p">)),</span>
                                 <span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">sz</span><span class="p">(</span><span class="n">xy</span><span class="p">(</span><span class="mf">0.67</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">quit</span><span class="p">))))),</span>
                <span class="n">rc</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ref</span><span class="p">(</span><span class="n">c</span><span class="p">)));</span>

    <span class="n">window</span><span class="o">&lt;</span><span class="n">decltype</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">&amp;&gt;</span> <span class="n">wnd</span><span class="p">(</span><span class="s">"foo"</span><span class="p">,</span> <span class="n">vec</span><span class="p">(),</span> <span class="p">{</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">},</span> <span class="n">z</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">i</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wnd</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Functions make_radio_button and make_resizing are defined in a separate file. 
They demonstrate two different ways how micro widgets can be composed in encapsulated 
way that hides the internal types and implementations (as you probably don't want to define complex template instances in your shared headers). The first way sets up everything in a single function body so that widget state is split into several heap blocks, while the second builds widget in single heap area, but it requires an additional class and some boilerplate code.</p>

<p>The essential interface for encapsulation is the itoy class that has 3 methods 
that are a) size, b) draw and c) recv. owned_itoy or shared_itoy functions 
can be used to wrap a compile-time composed widget inside itoy interface or
class can implement the interface directly as done in resizing_item class. </p>

<div class="highlight highlight-C++"><pre><span class="cp">#include "toys/sdl.h"</span>
<span class="cp">#include &lt;functional&gt;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">toys</span><span class="o">::</span><span class="n">sdl</span><span class="o">::</span><span class="n">vals</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">toys</span><span class="o">::</span><span class="n">sdl</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">toys</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="c1">// following widget does not require separate class definition, but its state gets allocated in heap</span>
<span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">itoy</span><span class="o">&gt;</span> <span class="n">make_radio_button</span><span class="p">(</span><span class="k">const</span> <span class="n">font</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">,</span> <span class="k">const</span> <span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="o">&gt;&amp;</span> <span class="n">changed</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">state</span><span class="p">(</span><span class="k">new</span> <span class="kt">bool</span><span class="p">(</span><span class="nb">false</span><span class="p">));</span>
    <span class="n">rgba</span> <span class="n">black</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">itoy</span><span class="o">&gt;</span> <span class="n">on</span> <span class="o">=</span> <span class="n">shared_itoy</span><span class="p">(</span><span class="n">fb</span><span class="p">(</span><span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">tx</span><span class="p">(</span><span class="s">"on"</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">black</span><span class="p">)),</span> <span class="n">rc</span><span class="p">(</span><span class="n">rgba</span><span class="p">{</span><span class="mi">150</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">0</span><span class="p">})));</span>
    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">itoy</span><span class="o">&gt;</span> <span class="n">off</span> <span class="o">=</span> <span class="n">shared_itoy</span><span class="p">(</span><span class="n">fb</span><span class="p">(</span><span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">tx</span><span class="p">(</span><span class="s">"off"</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">black</span><span class="p">)),</span> <span class="n">rc</span><span class="p">(</span><span class="n">rgba</span><span class="p">{</span><span class="mi">250</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">0</span><span class="p">})));</span>
    <span class="k">return</span>
        <span class="nf">owned_itoy</span><span class="p">(</span>
        <span class="n">sz</span><span class="p">(</span><span class="n">xy</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
                <span class="n">on_click</span><span class="p">([</span><span class="n">state</span><span class="p">,</span> <span class="n">changed</span><span class="p">](</span><span class="n">click</span><span class="o">&amp;</span><span class="p">)</span> <span class="p">{</span><span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="o">!*</span><span class="n">state</span><span class="p">;</span> <span class="n">changed</span><span class="p">(</span><span class="o">*</span><span class="n">state</span><span class="p">);},</span>
                         <span class="n">prop</span><span class="p">([</span><span class="n">state</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="n">off</span><span class="p">,</span> <span class="n">black</span><span class="p">]</span> <span class="p">()</span> <span class="p">{</span> 
                                  <span class="k">return</span> <span class="o">*</span><span class="n">state</span> <span class="o">?</span> <span class="n">on</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">:</span> <span class="n">off</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
                   <span class="p">}))));</span>
<span class="p">}</span>

<span class="c1">// composing a stateful and flat (not split into several memory blocks) widget from stateless</span>
<span class="c1">// microwidgets is possible, if a bit clumsy.</span>
<span class="k">auto</span> <span class="n">make_resizing_toy</span><span class="p">(</span><span class="n">vec</span><span class="o">*</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">on_click</span><span class="p">([</span><span class="n">v</span><span class="p">](</span><span class="n">click</span><span class="o">&amp;</span> <span class="n">c</span><span class="p">){</span><span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">()</span> <span class="o">==</span> <span class="mi">50</span><span class="p">)</span> <span class="o">?</span> <span class="n">vec</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">:</span><span class="n">vec</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span> <span class="p">},</span>
                    <span class="n">sz</span><span class="p">([</span><span class="n">v</span><span class="p">](</span><span class="n">vec</span><span class="p">){</span><span class="k">return</span> <span class="o">*</span><span class="n">v</span><span class="p">;},</span> <span class="n">rc</span><span class="p">(</span><span class="n">rgba</span><span class="p">{</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">})));</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">resizing_item</span> <span class="o">:</span> <span class="k">public</span> <span class="n">itoy</span> <span class="p">{</span>
<span class="nl">private:</span>
    <span class="n">vec</span> <span class="n">sz_</span><span class="p">;</span>
    <span class="n">decltype</span><span class="p">(</span><span class="n">make_resizing_toy</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="n">toy_</span><span class="p">;</span>
<span class="nl">public:</span>
    <span class="n">resizing_item</span><span class="p">()</span> <span class="o">:</span> <span class="n">sz_</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">toy_</span><span class="p">(</span><span class="n">make_resizing_toy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sz_</span><span class="p">))</span> <span class="p">{}</span>
    <span class="n">vec</span> <span class="n">size</span><span class="p">(</span><span class="k">const</span> <span class="n">vec</span><span class="o">&amp;</span> <span class="n">size</span><span class="p">)</span> <span class="k">const</span>                    <span class="p">{</span> <span class="k">return</span> <span class="n">toy_</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">(</span><span class="n">size</span><span class="p">);</span> <span class="p">};</span>
    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="k">const</span> <span class="n">vec</span><span class="o">&amp;</span> <span class="n">size</span><span class="p">,</span> <span class="n">graphics_type</span><span class="o">&amp;</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">toy_</span><span class="o">-&gt;</span><span class="n">draw</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span> <span class="p">}</span>
    <span class="kt">bool</span> <span class="n">recv</span><span class="p">(</span><span class="k">const</span> <span class="n">vec</span><span class="o">&amp;</span> <span class="n">size</span><span class="p">,</span> <span class="n">ievent</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span>              <span class="p">{</span> <span class="k">return</span> <span class="n">toy_</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>
<span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">itoy</span><span class="o">&gt;</span> <span class="n">make_resizing_item</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">itoy</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">resizing_item</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>

<p>The result of the presented code is a simple UI with 4 widgets that can be clicked and 4 items with dynamic properties (resizing widget, radio button changes appearance, rgb text updates, background color changes). </p>

<p>When application launches, it looks following: </p>

<p><img src="http://arauhala.github.io/libtoys/toyexample.png" alt=""></p>

<p>After clicking resizing button, putting radio widget on and clicking 'more blue' button the application looks like this: </p>

<p><img src="http://arauhala.github.io/libtoys/toyexample_post.png" alt=""></p>

<h1>
<a name="author" class="anchor" href="#author"><span class="octicon octicon-link"></span></a>Author</h1>

<p>I (Antti Rauhala) am a software engineer and data scientist at Futurice, who has a background in systems programming, mobile, machine learning and search. My previous projects are freeform (freeform.sourceforge.net) meta language and re-expression method (libreexp.github.com) that is a new kind of representation learning method.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/arauhala">arauhala</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>