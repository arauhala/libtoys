<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Libtoys : Generic C++ microwidgets for UI development (proof of concept)" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Libtoys</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/arauhala/libtoys">View on GitHub</a>

          <h1 id="project_title">Libtoys</h1>
          <h2 id="project_tagline">Generic C++ microwidgets for UI development (proof of concept)</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/arauhala/libtoys/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/arauhala/libtoys/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>
<a name="introduction-to-libtoys" class="anchor" href="#introduction-to-libtoys"><span class="octicon octicon-link"></span></a>Introduction to libtoys</h3>

<p>libtoys demonstrates an idea of microwidgets, which are simplest possible UI widgets doing exactly one things and nothing more. For example the libtoys library contains following widgets:</p>

<ul>
<li>sz       - sets size of the enclosed micro widget</li>
<li>split    - splits an area in either x, y or z dimension. </li>
<li>lay      - positions a toy up, down, left, middle or some other 
            relative or absolute coordinate.</li>
<li>tx       - a simple string</li>
<li>rc       - rectangle</li>
<li>on_click - consumes a mouse click hitting the microwidget region.</li>
</ul><p>For example, these widgets can be used in following way to construct a button (code is C++14):</p>

<div class="highlight highlight-C++"><pre><span class="k">auto</span> <span class="n">quit</span> <span class="o">=</span> 
    <span class="n">sz</span><span class="p">(</span><span class="n">xy</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>                                <span class="c1">// 1. set size</span>
       <span class="n">on_click</span><span class="p">([](</span><span class="n">click</span><span class="o">&amp;</span><span class="p">){</span> <span class="n">system</span><span class="o">::</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="p">},</span>    <span class="c1">// 2. exit on click</span>
                <span class="n">fb</span><span class="p">(</span><span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">tx</span><span class="p">(</span><span class="s">"exit"</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">black</span><span class="p">)),</span> <span class="c1">// 3. text on front middle</span>
                   <span class="n">rc</span><span class="p">(</span><span class="n">rgba</span><span class="p">{</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span><span class="mi">0</span><span class="p">})));</span>    <span class="c1">// 4. rectangle background</span>
</pre></div>

<p>sz determines the component to be pixel 100 wide and 25 pixel high. on_click makes application 'exit' when the component is clicked. lay(mid, x) positions the text in the middle and fb splits the 'space' into foreground and background, where the text (tx) is layouted front and rectangle (rc) is layouted back. </p>

<h3>
<a name="design-and-capabilities" class="anchor" href="#design-and-capabilities"><span class="octicon octicon-link"></span></a>Design and capabilities</h3>

<p>While libtoys is a proof of concept and simply lacks maturity to support real development, the basic design combines many ideas and values that can be considered valuable. Here the leading idea behind libtoys is minimalism and genericity and it follows strictly the UNIX idea that the system should consist of minimalistic tools doing one thing right, and the power should raise from the structure and  the way the components are combined. This minimalism brings many benefits: </p>

<ul>
<li>small learning overhead. libtoys contains half dozen primitives. if it seeks real usage this number will inevitably grow, but not necessarily much.</li>
<li>the small base of simple but powerful items is easy master. this easiness to master comprehend the powerful tool set is expected to make the programming much more productive and efficient.</li>
<li>the abstract technical items are forever (e.g. BSD sockets), while more specific services tend to....<br><ol>
<li>...not entirely fit the users needs (some widget is inadequate or missing) </li>
<li>...obsolete as the technology advances or the needs change. </li>
<li>This leads to wide creation of custom UI components, which creation most UI toolkits allow, but do not specially support.</li>
</ol>
</li>
</ul><p>Other design goals of libtoys have been:</p>

<ul>
<li>genericity. libtoys can be used to layout and draw 'text' (as demonstrated in unit test cases) as well to treat normal 2D graphics (as demonstrated by the OpenSDL usage). </li>
<li>declarativeness. you can create diverse custom components and layouts without writing a line of imperative drawing or layouting code.</li>
<li>statelessness. all microwidgets are stateless. the statelessness reduces the complexity by lot and eliminates huge class of bugs.</li>
<li>terseness. creating a micro widget component can be done inline and requires 0 class definitions. short names are preferred over more verbose names.</li>
<li>minimized overhead. 

<ol>
<li>it is accepted that a traditional widget may consist of dozens of even hundreds of microwidgets. this traditional could mean e.g. hundreds of heap allocations meaning huge overhead over a flat design. </li>
<li>this overhead is avoided with template magic (enabled by C++14) that allows of flattening a deep microwidget structure into a single C++ class. E.g. the 7 microwidget button in previous example has sizeof(quit) 96 bytes and can be entirely allocated in stack meaning 0 heap usage and lighting speed. </li>
<li>This flatting of structure should (?) also flatten/inline the generate template code making single highly optimized and flat draw &amp; layouting routines for single widget instead of generating routines for all dozens of specialized microwidgets.</li>
</ol>
</li>
</ul><p>Also the extreme simplicity, declarativeness, statelessness and terseness are expected to improve productivity. At least this is my own experience having worked with similar UI kit (for Java). You can quickly master the simple toolkit and you need to write very little code and care for very few things (no states), which makes things much easier &amp; faster. </p>

<p>Of course as a disclaimer: you cannot actually do lot with the library (yet), as it is very much a POC and very incomplete. Also; the solution has other 'flaws', e.g. simple mistakes can generate pages of errors, which is a side effect of heavy reliance on templates.</p>

<h3>
<a name="code-sample--screenshot" class="anchor" href="#code-sample--screenshot"><span class="octicon octicon-link"></span></a>Code sample &amp; screenshot:</h3>

<p>Last, but not least a code sample demonstrating the toolkit. Following example demonstrates writing a simple interactive UI with a manipulated state (variable c) and a dynamic property (rgbtext) that changes when c is modified. </p>

<p>The code also demonstrates the 3 functions used for creating split-microwidgets. These functios are 'ud' splitting widget to up and down parts, 'lr' splitting widget into left and right parts and fb splitting widget into front and back parts</p>

<div class="highlight highlight-C++"><pre><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">toys</span><span class="p">;</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">toys</span><span class="o">::</span><span class="n">sdl</span><span class="p">;</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">toys</span><span class="o">::</span><span class="n">sdl</span><span class="o">::</span><span class="n">vals</span><span class="p">;</span>
    <span class="n">sdltoys</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">font</span> <span class="n">f</span><span class="p">(</span><span class="s">"/usr/share/fonts/truetype/freefont/FreeMono.ttf"</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>

    <span class="k">const</span> <span class="n">rgba</span> <span class="n">black</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span> <span class="c1">// this is constant</span>
    <span class="n">rgba</span> <span class="n">c</span><span class="p">{</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>       <span class="c1">// this is used by reference</span>
    <span class="k">auto</span> <span class="n">rgbtxt</span> <span class="o">=</span> <span class="n">prop</span><span class="p">([</span><span class="o">&amp;</span><span class="n">c</span><span class="p">]()</span> <span class="p">{</span>       <span class="c1">// this is property generated by lambda</span>
        <span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span> <span class="n">buf</span><span class="p">;</span>
        <span class="n">buf</span><span class="o">&lt;&lt;</span><span class="s">"r:"</span><span class="o">&lt;&lt;</span><span class="kt">int</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">r</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="s">",g:"</span><span class="o">&lt;&lt;</span><span class="kt">int</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">g</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="s">",b:"</span><span class="o">&lt;&lt;</span><span class="kt">int</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">b</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">buf</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="c1">// widgets on screen</span>
    <span class="k">auto</span> <span class="n">moreblue</span> <span class="o">=</span> <span class="n">on_click</span><span class="p">([</span><span class="o">&amp;</span><span class="n">c</span><span class="p">](</span><span class="n">click</span><span class="o">&amp;</span><span class="p">){</span><span class="n">c</span><span class="p">.</span><span class="n">b</span><span class="o">+=</span><span class="mi">25</span><span class="p">;</span> <span class="p">},</span>
                     <span class="n">fb</span><span class="p">(</span><span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">tx</span><span class="p">(</span><span class="s">"more blue"</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">black</span><span class="p">)),</span> <span class="n">rc</span><span class="p">(</span><span class="n">rgba</span><span class="p">{</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">0</span><span class="p">})));</span>
    <span class="k">auto</span> <span class="n">text</span> <span class="o">=</span> <span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">tx</span><span class="p">(</span><span class="n">rgbtxt</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">black</span><span class="p">));</span>
    <span class="k">auto</span> <span class="n">quit</span> <span class="o">=</span> <span class="n">on_click</span><span class="p">([](</span><span class="n">click</span><span class="o">&amp;</span><span class="p">){</span> <span class="n">system</span><span class="o">::</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="p">},</span>
                         <span class="n">fb</span><span class="p">(</span><span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">tx</span><span class="p">(</span><span class="s">"exit"</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">black</span><span class="p">)),</span> <span class="n">rc</span><span class="p">(</span><span class="n">rgba</span><span class="p">{</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span><span class="mi">0</span><span class="p">})));</span>

    <span class="c1">// the ui</span>
    <span class="k">auto</span> <span class="n">z</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">ud</span><span class="p">(</span><span class="mf">0.33</span><span class="p">,</span>  <span class="c1">// allocate 33% to text and rest to buttons</span>
                   <span class="n">text</span><span class="p">,</span>
                   <span class="n">ud</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">sz</span><span class="p">(</span><span class="n">xy</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">moreblue</span><span class="p">)),</span>
               <span class="n">lay</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">sz</span><span class="p">(</span><span class="n">xy</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">quit</span><span class="p">)))),</span>
                <span class="n">rc</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ref</span><span class="p">(</span><span class="n">c</span><span class="p">)));</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"quit size is %lu B</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">text</span><span class="p">));</span> <span class="c1">// 96 B  on my machine</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"toy size is %lu B</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">z</span><span class="p">));</span>     <span class="c1">// 344 B on my machine</span>

    <span class="n">window</span><span class="o">&lt;</span><span class="n">decltype</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">&amp;&gt;</span> <span class="n">wnd</span><span class="p">(</span><span class="s">"foo"</span><span class="p">,</span> <span class="n">vec</span><span class="p">(),</span> <span class="p">{</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">},</span> <span class="n">z</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">i</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wnd</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h1>
<a name="author" class="anchor" href="#author"><span class="octicon octicon-link"></span></a>Author</h1>

<p>I (Antti Rauhala) am a software engineer and data scientist at Futurice, who has a background in systems programming, mobile, machine learning and search. My previous projects are freeform (freeform.sourceforge.net) meta language and re-expression method (libreexp.github.com) that is a new kind of representation learning method.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Libtoys maintained by <a href="https://github.com/arauhala">arauhala</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
